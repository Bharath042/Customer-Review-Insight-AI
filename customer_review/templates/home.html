{% extends "base_user_dashboard.html" %}

{% block title %}Dashboard | ReviewSense AI{% endblock %}

{% block content %}
    <header class="header"><h1>Welcome, {{ username }}</h1></header>

    <!-- Analysis Summary Cards -->
    <div class="analysis-summary" 
        style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; margin-bottom: 20px;">

        <!-- Total Reviews -->
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, transparent 100%); border: 1px solid var(--border-color); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 10px;">
            <div class="summary-icon" style="width: 40px; height: 40px; background-color: #6c757d; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-file-alt" style="font-size: 1.2rem; color: white;"></i>
            </div>
            <div class="summary-content">
                <h3 style="margin: 0; font-size: 1.4rem; color: var(--text-primary); font-weight: 700;">{{ stats.total_reviews }}</h3>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.8rem;">Total Reviews</p>
            </div>
        </div>

        <!-- Aspects Identified -->
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(74, 144, 226, 0.1) 0%, transparent 100%); border: 1px solid var(--border-color); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 10px;">
            <div class="summary-icon" style="width: 40px; height: 40px; background-color: var(--accent-blue); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-tags" style="font-size: 1.2rem; color: white;"></i>
            </div>
            <div class="summary-content">
                <h3 style="margin: 0; font-size: 1.4rem; color: var(--text-primary); font-weight: 700;">{{ total_aspects }}</h3>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.8rem;">Aspects Identified</p>
            </div>
        </div>

        <!-- Positive Sentiments -->
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, transparent 100%); border: 1px solid var(--border-color); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 10px;">
            <div class="summary-icon" style="width: 40px; height: 40px; background-color: #28a745; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-smile" style="font-size: 1.2rem; color: white;"></i>
            </div>
            <div class="summary-content">
                <h3 style="margin: 0; font-size: 1.4rem; color: var(--text-primary); font-weight: 700;">{{ positive_count }}</h3>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.8rem;">Positive Aspects</p>
            </div>
        </div>

        <!-- Neutral Sentiments -->
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(108, 117, 125, 0.1) 0%, transparent 100%); border: 1px solid var(--border-color); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 10px;">
            <div class="summary-icon" style="width: 40px; height: 40px; background-color: #6c757d; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-meh" style="font-size: 1.2rem; color: white;"></i>
            </div>
            <div class="summary-content">
                <h3 style="margin: 0; font-size: 1.4rem; color: var(--text-primary); font-weight: 700;">{{ neutral_count }}</h3>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.8rem;">Neutral Aspects</p>
            </div>
        </div>

        <!-- Negative Sentiments -->
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, transparent 100%); border: 1px solid var(--border-color); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 10px;">
            <div class="summary-icon" style="width: 40px; height: 40px; background-color: #dc3545; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-frown" style="font-size: 1.2rem; color: white;"></i>
            </div>
            <div class="summary-content">
                <h3 style="margin: 0; font-size: 1.4rem; color: var(--text-primary); font-weight: 700;">{{ negative_count }}</h3>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.8rem;">Negative Aspects</p>
            </div>
        </div>

        <!-- Avg Confidence -->
        <div class="summary-card" style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, transparent 100%); border: 1px solid var(--border-color); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 10px;">
            <div class="summary-icon" style="width: 40px; height: 40px; background-color: #ffc107; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-chart-line" style="font-size: 1.2rem; color: white;"></i>
            </div>
            <div class="summary-content">
                <h3 style="margin: 0; font-size: 1.4rem; color: var(--text-primary); font-weight: 700;">{{ avg_confidence }}%</h3>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.8rem;">Avg Confidence</p>
            </div>
        </div>

    </div>


    <div class="dashboard-grid">
        <div class="side-panel">
            <section class="table-container card">
                <h2>My Recent Reviews</h2>
                <table>
                    <thead><tr><th>Review</th><th>Sentiment</th></tr></thead>
                    <tbody>
                        {% for review in recent_reviews %}
                        <tr>
                            <td>{{ review.content | truncate(50) }}</td>
                            <td>
                                {% set sentiment = review.sentiment.strip().upper() if review.sentiment else "NEUTRAL" %}
                                {% if sentiment == "POSITIVE" %}
                                    <span class="sentiment-label positive">Positive</span>
                                {% elif sentiment == "NEGATIVE" %}
                                    <span class="sentiment-label negative">Negative</span>
                                {% else %}
                                    <span class="sentiment-label neutral">Neutral</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="2" style="text-align: center;">You havenâ€™t submitted any reviews yet.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </section>
        </div>

        <div class="main-panel">
            <section class="card">
                <h2>My Sentiment Distribution</h2>
                <div style="max-height: 250px; display: flex; justify-content: center; align-items: center;">
                    <canvas id="userSentimentChart"></canvas>
                </div>
            </section>
        </div>
    </div>
{% endblock %}

{% block scripts %} {# Add the Chart.js script to the scripts block #}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const ctx = document.getElementById('userSentimentChart').getContext('2d');
            const chartData = {{ chart_data | tojson }};
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Positive', 'Negative', 'Neutral'],
                    datasets: [{
                        label: 'My Sentiment Distribution',
                        data: [chartData.positive, chartData.negative, chartData.neutral],
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(220, 53, 69, 0.8)',
                            'rgba(108, 117, 125, 0.8)'
                        ],
                        borderColor: ['#161b22','#161b22','#161b22'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e6edf3',
                                font: { family: "'Poppins', sans-serif" },
                                padding: 34
                            }
                        }
                    }
                }
            });
        });
    </script>
{% endblock %}